{% extends 'layouts/home.html' %}
{% load static %}
{% load custom_filters %}


{% block title %}
–û–ª–∏–º–ø–∏—è–¥–∞–ª–∞—Ä | e-Teacher
{% endblock title %}


{% block home_content %}
<style>
    .container {
        justify-content: center;
        align-items: center;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* –°—Ç—Ä–µ–ª–∫–∞ */
    .arrow {
        position: absolute;
        top: 15px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
    }

    .arrow::before {
        content: "";
        display: block;
        width: 0;
        height: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        border-bottom: 25px solid red;
    }

    canvas {
        margin-bottom: 10px;
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
    .modals {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
</style>

<div class="grid grid-cols-1 gap-8 lg:grid-cols-2 pt-8 2xl:container mx-auto">
    <div>
        <div class="container">
            <div class="relative">
                <div class="arrow"></div>
                <canvas id="canvas" width="500" height="500"></canvas>
            </div>
        
            <button id="spin" type="button"
                class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                –ê–π–Ω–∞–ª–¥—ã—Ä—É
            </button>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
        <div class="modals" id="modal">
            <div class="bg-white max-w-screen-md p-5 rounded-xl w-full min-h-[420px] flex justify-center items-center relative">
                <div class="grid gap-2">
                    <h1 class="text-2xl text-center font-semibold">–°“±—Ä–∞“õ –Ω”©–º–µ—Ä—ñ: <span id="modal-header"></span></h1>
                    <div id="modal-content" class="text-gray-500"></div>
                </div>
                <button id="modal-close"
                    class="absolute bottom-2 right-2 text-sm text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                    –ñ–∞–±—É
                </button>
            </div>
        </div>
    </div>

    <!-- Form -->
     <div>
        <h1 class="text-2xl font-semibold mb-4">–¢–∞–ø—Å—ã—Ä–º–∞–Ω—ã –∂—ñ–±–µ—Ä—É —Ñ–æ—Ä–º–∞—Å—ã</h1>
        <form 
            method="post" enctype="multipart/form-data"
            class="grid gap-4"    
        >
            {% csrf_token %}
            <select 
                id="countries"
                name="score"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
            >
                <option value="" selected>–°“±—Ä–∞“õ –Ω”©–º–µ—Ä—ñ</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="9">10</option>
                <option value="9">11</option>
                <option value="9">12</option>
            </select>

            <textarea 
                id="message"
                name="content"
                rows="4" 
                class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" 
                placeholder="–ñ–∞—É–∞–ø—Ç—ã –º”ô—Ç—ñ–Ω –∫“Ø–π—ñ–Ω–¥–µ –∂–∞–∑—ã“£—ã–∑..."></textarea>


            
            <input 
                id="file_input" 
                name="submission" 
                type="file" required
                class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400"
            >

            <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                –¢–∞–ø—Å—ã—Ä–º–∞–Ω—ã –∂—ñ–±–µ—Ä—É
            </button>
        </form>
     </div>
</div>


<script>
    // üéØ –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–µ–∫—Ç–æ—Ä–æ–≤
    const questions = [
        "”®–º—ñ—Ä—ñ“£—ñ–∑–¥–µ–≥—ñ –µ“£ “õ—ã–∑—ã“õ—Ç—ã –æ“õ–∏“ì–∞ “õ–∞–Ω–¥–∞–π?",
        "–ë–∞–ª–∞ –∫–µ–∑—ñ“£—ñ–∑–¥–µ –∞—Ä–º–∞–Ω–¥–∞“ì–∞–Ω –º–∞–º–∞–Ω–¥—ã“ì—ã“£—ã–∑ “õ–∞–Ω–¥–∞–π –µ–¥—ñ?",
        "–°—ñ–∑ “Ø—à—ñ–Ω –µ“£ –º–∞“£—ã–∑–¥—ã “õ“±–Ω–¥—ã–ª—ã“õ –Ω–µ?",
        "–°“Ø–π—ñ–∫—Ç—ñ –∫—ñ—Ç–∞–±—ã“£—ã–∑ “õ–∞–Ω–¥–∞–π?",
        "–°—ñ–∑–≥–µ –µ“£ –∫”©–ø —à–∞–±—ã—Ç –±–µ—Ä–µ—Ç—ñ–Ω –∞–¥–∞–º –∫—ñ–º?",
        "–ï–≥–µ—Ä —É–∞“õ—ã—Ç –º–∞—à–∏–Ω–∞—Å—ã –±–æ–ª—Å–∞, “õ–∞–π –∫–µ–∑–µ“£–≥–µ –±–∞—Ä“ì—ã“£—ã–∑ –∫–µ–ª–µ–¥—ñ?",
        "–°“Ø–π—ñ–∫—Ç—ñ —Ñ–∏–ª—å–º—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ —Å–µ—Ä–∏–∞–ª—ã“£—ã–∑ “õ–∞–Ω–¥–∞–π?",
        "–°—ñ–∑ “Ø—à—ñ–Ω –µ“£ “±–º—ã—Ç—ã–ª–º–∞—Å —Å–∞—è—Ö–∞—Ç “õ–∞–Ω–¥–∞–π –±–æ–ª–¥—ã?",
        "”®–∑—ñ“£—ñ–∑–¥—ñ “Ø—à —Å”©–∑–±–µ–Ω “õ–∞–ª–∞–π —Å–∏–ø–∞—Ç—Ç–∞–π—Å—ã–∑?",
        "–°—ñ–∑–¥—ñ –±–∞“õ—ã—Ç—Ç—ã –µ—Ç–µ—Ç—ñ–Ω –Ω”ô—Ä—Å–µ –Ω–µ?",
        "–ï–≥–µ—Ä —Å—É–ø–µ—Ä“õ–∞–±—ñ–ª–µ—Ç –∞–ª–∞—Ç—ã–Ω –±–æ–ª—Å–∞“£—ã–∑, “õ–∞–Ω–¥–∞–π “õ–∞–±—ñ–ª–µ—Ç —Ç–∞“£–¥–∞—Ä –µ–¥—ñ“£—ñ–∑?",
        "”®–º—ñ—Ä–¥–µ “õ–∞–Ω–¥–∞–π –∞—Ä–º–∞–Ω—ã“£—ã–∑–¥—ã –º—ñ–Ω–¥–µ—Ç—Ç—ñ —Ç“Ø—Ä–¥–µ –æ—Ä—ã–Ω–¥–∞“ì—ã“£—ã–∑ –∫–µ–ª–µ–¥—ñ?"
    ];

    let startAngle = 0;
    const arc = Math.PI / (questions.length / 2);
    let spinTimeout = null;
    let spinAngleStart = 0;
    let spinTime = 0;
    let spinTimeTotal = 0;

    let ctx;

    const modal = document.getElementById('modal');
    const modalHead = document.getElementById('modal-header');
    const modalContent = document.getElementById('modal-content');
    const modalClose = document.getElementById('modal-close');

    document.getElementById("spin").addEventListener("click", spin);
    modalClose.addEventListener("click", () => {
        modal.style.display = 'none';
    });

    // üé® –¶–≤–µ—Ç–∞ –¥–ª—è —Å–µ–∫—Ç–æ—Ä–æ–≤
    function getColor(index) {
        const colors = ["#FF5733", "#FFC300", "#DAF7A6", "#C70039", "#900C3F", "#581845", "#1E90FF", "#FF69B4", "#7FFF00", "#FFD700", "#FF4500", "#ADFF2F"];
        return colors[index % colors.length];
    }

    // üéØ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–ª–µ—Å–∞
    function drawRouletteWheel() {
        const canvas = document.getElementById("canvas");
        if (canvas.getContext) {
            const outsideRadius = 200;
            const textRadius = 160;
            const insideRadius = 50;

            ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, 500, 500);

            ctx.strokeStyle = "black";
            ctx.lineWidth = 2;
            ctx.font = 'bold 16px Arial';

            for (let i = 0; i < questions.length; i++) {
                const angle = startAngle + i * arc;
                ctx.fillStyle = getColor(i);

                ctx.beginPath();
                ctx.arc(250, 250, outsideRadius, angle, angle + arc, false);
                ctx.arc(250, 250, insideRadius, angle + arc, angle, true);
                ctx.stroke();
                ctx.fill();

                ctx.save();
                ctx.fillStyle = "white";
                ctx.translate(
                    250 + Math.cos(angle + arc / 2) * textRadius,
                    250 + Math.sin(angle + arc / 2) * textRadius
                );
                ctx.rotate(angle + arc / 2 + Math.PI / 2);
                ctx.fillText(i + 1, -ctx.measureText(i + 1).width / 2, 0);
                ctx.restore();
            }
        }
    }

    // üåÄ –í—Ä–∞—â–µ–Ω–∏–µ
    function spin() {
        spinAngleStart = Math.random() * 10 + 10;
        spinTime = 0;
        spinTimeTotal = Math.random() * 3 + 4 * 1000;
        rotateWheel();
    }

    function rotateWheel() {
        spinTime += 30;
        if (spinTime >= spinTimeTotal) {
            stopRotateWheel();
            return;
        }
        const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
        startAngle += (spinAngle * Math.PI / 180);
        drawRouletteWheel();
        spinTimeout = setTimeout(rotateWheel, 30);
    }

    // üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–ª–µ—Å–∞
    function stopRotateWheel() {
        clearTimeout(spinTimeout);
        const degrees = (startAngle * 180 / Math.PI + 90) % 360;
        const index = Math.floor((360 - degrees) / (360 / questions.length)) % questions.length;

        const result = `üéØ ${questions[index]}`;
        modalHead.textContent = index;
        modalContent.textContent = result;
        modal.style.display = 'flex';

        drawRouletteWheel();
    }

    function easeOut(t, b, c, d) {
        t /= d;
        return -c * t * (t - 2) + b;
    }

    drawRouletteWheel();
</script>
{% endblock home_content %}